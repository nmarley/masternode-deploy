---

- name: Pre-Install - Python3 and Aptitude
  hosts: all
  become: true
  gather_facts: no
  tasks:
    - name: update apt cache
      raw: apt-get update
    - name: install python and aptitude
      raw: apt-get -y install python3 python3-pip aptitude

- name: Update apt cache
  hosts: all
  become: true
  tasks:
    - name: Run apt-get update if the latest one is more than an hour ago
      apt:
        update_cache: yes
        cache_valid_time: 3600

- name: Set up environment
  hosts: all
  become: true
  tags: environment
  roles:
    - nickjj.user
    - nickjj.sshd
    - nickjj.swapfile

- name: install geerlinguy roles
  hosts: all
  vars:
    pip_install_packages:
      - name: docker
  roles:
    - geerlingguy.pip
    - geerlingguy.docker

- name: Set up masternode
  hosts: all
  tags: masternode
  become: true
  pre_tasks:
  - name: Create docker network
    docker_network:
      name: '{{ docker_network_name }}'
  - include: set_network.yml
  - set_fact:
      dashd_zmq: true
      dashd_indexes: true
    when: evo_services
  roles:
    - dashd
    - role: sentinel
      when: masternode
    - role: insight
      when: evo_services
    - role: dapi
      when: evo_services
    - role: drive
      when: evo_services
    - role: js-machine
      when: evo_services
